<div [class.sub-row]="title">
    <p>{{ title }}</p>
    <mat-table [dataSource]="dataSource" multiTemplateDataRows>

        <!-- COLUMNS AND ROWS-->
        <ng-container *ngFor="let key of displayedColumns" [matColumnDef]="key">
            <mat-header-cell *matHeaderCellDef>{{ key.includes('Icon') ? '' : key }}</mat-header-cell>

            <mat-cell *matCellDef="let element; let i = dataIndex">

                <span *ngIf="!key.includes('Icon'); else icon">{{ element.data[key] }}</span>

                <ng-template #icon>
                    <mat-icon *ngIf="element.kids[iconKeyReference] && key === 'expandIcon'"
                        [class.active]="element.data[referenceId] === expandedId"
                        (click)="toggleExpandableSymbol(element.data[referenceId])">play_arrow</mat-icon>

                    <!-- <mat-icon *ngIf="!title && key === 'deleteIcon'" (click)="deleteTarget.next(i)">delete_forever
                    </mat-icon> -->

                    <button *ngIf="renderTemplate === 'subTarget' && key === 'deleteIcon'" (click)="addSubTarget.next(element.data['Target ID'])">Add Sub Target
                    </button>

                    <button *ngIf="renderTemplate === 'method' && key === 'deleteIcon'" (click)="addMethod.next(element.data['Sub Target ID'])">Add Method
                    </button>
                </ng-template>

            </mat-cell>
        </ng-container>

        <!-- EXPANDABLE ROW -->
        <ng-container matColumnDef="expandedDetail">
            <mat-cell *matCellDef="let element"
                [@expandableRow]="element.data[referenceId] === expandedId ? 'expanded' : 'collapsed'">

                <div *ngIf="element.data[referenceId] === expandedId" class="width-100" [ngSwitch]="renderTemplate">

                    <app-sub-target-table *ngSwitchCase="'subTarget'" [runningNo]="runningNo" [targetId]="element.data['Target ID']" [subTargets]="element.kids.has_sub_targets.records">
                    </app-sub-target-table>

                    <app-method-table *ngSwitchCase="'method'" [runningNo]="runningNo" [targetId]="targetId" [methods]="element.kids.has_methods.records">
                    </app-method-table>

                </div>

            </mat-cell>
        </ng-container>

        <!-- -->
        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>

        <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>

        <mat-row class="expandable-row" *matRowDef="let row; columns: ['expandedDetail'];">
        </mat-row>

    </mat-table>
</div>